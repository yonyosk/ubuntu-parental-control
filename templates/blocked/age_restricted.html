{% extends "blocked/base_blocked.html" %}

{% block title %}Content Not Age-Appropriate{% endblock %}

{% block content %}
<!-- Icon -->
<div class="icon-container icon-warning icon-container-lg blocked-icon-large">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
    </svg>
</div>

<!-- Title -->
<h1 class="blocked-title">Content Not Age-Appropriate</h1>

<!-- Age Badge -->
{% if age_requirement %}
<div class="mb-4">
    <span class="badge badge-warning" style="font-size: var(--text-lg); padding: var(--space-2) var(--space-4);">
        {{ age_requirement }}+ Only
    </span>
</div>
{% endif %}

<!-- Blocked Domain -->
<div class="blocked-domain">{{ blocked_url }}</div>

<!-- Message -->
<div class="blocked-message">
    {% if block_reason %}
        {{ block_reason }}
    {% else %}
        This content is not appropriate for your age group and has been blocked for your protection.
    {% endif %}
</div>

<!-- Why is this protected? -->
<div class="card card-warning mt-6" style="text-align: left;">
    <div class="card-title" style="display: flex; align-items: center; gap: var(--space-2);">
        <span>ğŸ›¡ï¸</span>
        <span>Why is this protected?</span>
    </div>
    <p class="text-secondary mb-4">
        Age restrictions exist to keep you safe from content that may be:
    </p>
    <ul class="list-disc">
        <li>Not suitable for your current age</li>
        <li>Potentially harmful or disturbing</li>
        <li>Containing adult themes or mature content</li>
        <li>Beyond your current understanding or experience level</li>
    </ul>
    <p class="text-secondary mt-4">
        These restrictions are in place because we care about your wellbeing and safety online.
    </p>
</div>

<!-- Online Safety Tips -->
{% if safety_tips %}
<div class="card card-info mt-6" style="text-align: left;">
    <div class="card-title" style="display: flex; align-items: center; gap: var(--space-2);">
        <span>ğŸ’¡</span>
        <span>Online Safety Tips</span>
    </div>
    <ul class="list-disc">
        {% for tip in safety_tips %}
        <li>{{ tip }}</li>
        {% endfor %}
    </ul>
</div>
{% else %}
<div class="card card-info mt-6" style="text-align: left;">
    <div class="card-title" style="display: flex; align-items: center; gap: var(--space-2);">
        <span>ğŸ’¡</span>
        <span>Online Safety Tips</span>
    </div>
    <ul class="list-disc">
        <li>Always ask a parent or guardian before visiting unfamiliar websites</li>
        <li>Never share personal information (name, address, school, phone) online</li>
        <li>If something online makes you uncomfortable, tell a trusted adult immediately</li>
        <li>Remember that not everything you see online is true or safe</li>
        <li>Stick to websites and apps that are designed for your age group</li>
    </ul>
</div>
{% endif %}

<!-- Educational Resources -->
{% if resources %}
<div class="card mt-6" style="text-align: left;">
    <div class="card-title">Learn More About Online Safety</div>
    <p class="text-secondary mb-4">Check out these helpful resources:</p>
    <div style="display: flex; flex-direction: column; gap: var(--space-3);">
        {% for resource in resources %}
        <a href="{{ resource.url }}" target="_blank" rel="noopener noreferrer"
           style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-3); background-color: var(--color-bg-secondary); border-radius: var(--radius-md); text-decoration: none;">
            <div>
                <div class="font-semibold">{{ resource.name }}</div>
                <div class="text-sm text-secondary">{{ resource.description }}</div>
            </div>
            <span style="color: var(--color-primary);">â†’</span>
        </a>
        {% endfor %}
    </div>
</div>
{% else %}
<div class="card mt-6" style="text-align: left;">
    <div class="card-title">Learn More About Online Safety</div>
    <p class="text-secondary mb-4">Check out these helpful resources:</p>
    <div style="display: flex; flex-direction: column; gap: var(--space-3);">
        <a href="https://www.commonsensemedia.org/articles/parents-ultimate-guide-to-parental-controls"
           target="_blank" rel="noopener noreferrer"
           style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-3); background-color: var(--color-bg-secondary); border-radius: var(--radius-md); text-decoration: none;">
            <div>
                <div class="font-semibold">Common Sense Media</div>
                <div class="text-sm text-secondary">Age-appropriate media ratings and guides</div>
            </div>
            <span style="color: var(--color-primary);">â†’</span>
        </a>
        <a href="https://www.netsmartz.org/Home"
           target="_blank" rel="noopener noreferrer"
           style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-3); background-color: var(--color-bg-secondary); border-radius: var(--radius-md); text-decoration: none;">
            <div>
                <div class="font-semibold">NetSmartz</div>
                <div class="text-sm text-secondary">Internet safety education for kids</div>
            </div>
            <span style="color: var(--color-primary);">â†’</span>
        </a>
        <a href="https://www.internetsafety101.org/"
           target="_blank" rel="noopener noreferrer"
           style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-3); background-color: var(--color-bg-secondary); border-radius: var(--radius-md); text-decoration: none;">
            <div>
                <div class="font-semibold">Internet Safety 101</div>
                <div class="text-sm text-secondary">Comprehensive safety resource guide</div>
            </div>
            <span style="color: var(--color-primary);">â†’</span>
        </a>
    </div>
</div>
{% endif %}

<!-- Talk to Parents -->
<div class="card card-info mt-6">
    <div style="display: flex; gap: var(--space-4); align-items: center;">
        <div style="font-size: 2.5rem;">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
        <div style="flex: 1; text-align: left;">
            <div class="font-semibold mb-2">Have Questions?</div>
            <p class="text-secondary text-sm">
                If you have questions about why this is blocked or need to access something important,
                talk to your parent or guardian. They're here to help keep you safe online!
            </p>
        </div>
    </div>
</div>

<!-- Action Buttons (NO request access for age-restricted) -->
<div class="action-buttons">
    <button class="btn btn-primary" onclick="history.back()">
        Go Back
    </button>
    <button class="btn btn-ghost" onclick="showReportForm()">
        Report Site
    </button>
</div>

<!-- Report Form (for reporting inappropriate content) -->
<div id="report-form" style="display: none;" class="card mt-6">
    <h3 class="card-title">Report This Website</h3>
    <p class="text-secondary mb-4">
        If you encountered this website by accident or believe it should be reported, please let us know.
    </p>
    <form onsubmit="submitReport(event)">
        <div class="form-group">
            <label class="form-label" for="report-reason">What happened?</label>
            <textarea
                class="form-textarea"
                id="report-reason"
                name="report-reason"
                rows="3"
                required
                placeholder="Please describe how you encountered this website"></textarea>
        </div>
        <div class="action-buttons">
            <button type="submit" class="btn btn-primary">
                Submit Report
            </button>
            <button type="button" class="btn btn-ghost" onclick="hideReportForm()">
                Cancel
            </button>
        </div>
    </form>
</div>

<!-- Success Message -->
<div id="report-success" style="display: none;" class="alert alert-success mt-6">
    <strong>Report submitted!</strong> Thank you for letting us know.
</div>

<!-- Error Message -->
<div id="error-message" style="display: none;" class="alert alert-error mt-6">
    <strong>Error:</strong> <span id="error-text"></span>
</div>

{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    // Report Form
    function showReportForm() {
        document.getElementById('report-form').style.display = 'block';
        document.getElementById('report-form').scrollIntoView({ behavior: 'smooth' });
    }

    function hideReportForm() {
        document.getElementById('report-form').style.display = 'none';
    }

    // Submit Report
    async function submitReport(event) {
        event.preventDefault();

        const reportReason = document.getElementById('report-reason').value;

        try {
            const response = await fetch('/api/report-site', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    url: '{{ blocked_url }}',
                    type: 'age_restricted',
                    reason: reportReason
                })
            });

            const data = await response.json();

            if (response.ok) {
                hideReportForm();
                document.getElementById('report-success').style.display = 'block';
                document.getElementById('report-success').scrollIntoView({ behavior: 'smooth' });
            } else {
                showError(data.error || 'Failed to submit report. Please try again.');
            }
        } catch (error) {
            showError('Network error. Please check your connection and try again.');
        }
    }

    function showError(message) {
        document.getElementById('error-text').textContent = message;
        document.getElementById('error-message').style.display = 'block';
        document.getElementById('error-message').scrollIntoView({ behavior: 'smooth' });

        // Hide error after 5 seconds
        setTimeout(() => {
            document.getElementById('error-message').style.display = 'none';
        }, 5000);
    }
</script>
{% endblock %}
